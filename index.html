<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>POS Calculator</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        .receipt-paper {
            background: linear-gradient(to bottom, #ffffff 0%, #f8f9fa 100%);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .number-input {
            transition: all 0.2s ease;
        }
        .number-input:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .total-display {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            animation: pulse-subtle 2s infinite;
        }
        @keyframes pulse-subtle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.95; }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="min-h-full bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
  <div class="max-w-md mx-auto"><!-- Header -->
   <div class="text-center mb-6">
    <h1 id="store-title" class="text-3xl font-bold text-gray-800 mb-2">Quick POS</h1>
    <p class="text-gray-600">Point of Sale Calculator</p>
   </div><!-- Main Calculator Card -->
   <div class="receipt-paper rounded-2xl p-6 mb-4"><!-- Items Section -->
    <div class="mb-6">
     <h2 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">ðŸ›’ Items</h2>
     <div id="items-list" class="space-y-3 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50"><!-- Items will be added here -->
     </div><!-- Add Item Form -->
     <div class="mt-4 p-4 bg-gray-50 rounded-lg">
      <div class="mb-3"><input type="number" id="item-price" placeholder="Enter price..." step="0.01" min="0" inputmode="decimal" class="number-input w-full px-4 py-3 text-xl border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono">
      </div><button id="add-item-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-colors"> Add Price </button>
     </div>
    </div><!-- Calculations Section -->
    <div class="border-t border-gray-200 pt-4 space-y-3">
     <div class="total-display rounded-lg p-4 text-white">
      <div class="flex justify-between items-center"><span class="text-xl font-bold">TOTAL:</span> <span id="total" class="text-2xl font-bold font-mono">â‚±0.00</span>
      </div>
     </div>
    </div>
   </div><!-- Payment Section -->
   <div class="receipt-paper rounded-2xl p-6">
    <h2 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">ðŸ’³ Payment</h2>
    <div class="mb-4"><label for="amount-paid" class="block text-sm font-medium text-gray-700 mb-2"> Amount Paid </label> <input type="number" id="amount-paid" placeholder="0.00" step="0.01" min="0" inputmode="decimal" class="number-input w-full px-4 py-3 text-xl border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono">
    </div><!-- Change Display -->
    <div id="change-section" class="hidden">
     <div class="bg-green-50 border border-green-200 rounded-lg p-4">
      <div class="flex justify-between items-center"><span class="text-green-700 font-semibold">Change Due:</span> <span id="change-amount" class="text-2xl font-bold text-green-600 font-mono">$0.00</span>
      </div>
     </div>
    </div><!-- Insufficient Payment Warning -->
    <div id="insufficient-section" class="hidden">
     <div class="bg-red-50 border border-red-200 rounded-lg p-4">
      <div class="flex justify-between items-center"><span class="text-red-700 font-semibold">Still Owed:</span> <span id="owed-amount" class="text-xl font-bold text-red-600 font-mono">$0.00</span>
      </div>
     </div>
    </div><!-- Clear All Button --> <button id="clear-all-btn" class="w-full mt-4 bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-colors"> Clear All </button>
   </div>
  </div>
  <script>
        // Default configuration
        const defaultConfig = {
            store_name: "Quick POS",
            currency_symbol: "â‚±"
        };

        let items = [];
        let total = 0;

        // DOM elements
        const itemPriceInput = document.getElementById('item-price');
        const addItemBtn = document.getElementById('add-item-btn');
        const itemsList = document.getElementById('items-list');
        const totalEl = document.getElementById('total');
        const amountPaidInput = document.getElementById('amount-paid');
        const changeSectionEl = document.getElementById('change-section');
        const insufficientSectionEl = document.getElementById('insufficient-section');
        const changeAmountEl = document.getElementById('change-amount');
        const owedAmountEl = document.getElementById('owed-amount');
        const clearAllBtn = document.getElementById('clear-all-btn');

        // Add item functionality
        function addItem() {
            const price = parseFloat(itemPriceInput.value) || 0;
            
            if (price > 0) {
                const item = {
                    id: Date.now(),
                    price: price
                };
                
                items.push(item);
                renderItems();
                calculateTotals();
                
                // Clear input
                itemPriceInput.value = '';
                itemPriceInput.focus();
            }
        }

        // Render items list
        function renderItems() {
            if (items.length === 0) {
                itemsList.innerHTML = '<p class="text-gray-500 text-center py-4">No items added yet</p>';
                return;
            }

            const currencySymbol = (window.elementSdk?.config?.currency_symbol) || defaultConfig.currency_symbol;
            
            itemsList.innerHTML = items.map((item, index) => `
                <div class="flex justify-between items-center bg-white p-3 rounded-lg border">
                    <span class="font-medium text-gray-800">Item ${index + 1}</span>
                    <div class="flex items-center gap-2">
                        <span class="font-mono text-gray-700">${currencySymbol}${item.price.toFixed(2)}</span>
                        <button 
                            onclick="removeItem(${item.id})"
                            class="text-red-500 hover:text-red-700 font-bold text-lg"
                            title="Remove item"
                        >Ã—</button>
                    </div>
                </div>
            `).join('');
        }

        // Remove item
        function removeItem(id) {
            items = items.filter(item => item.id !== id);
            renderItems();
            calculateTotals();
        }

        // Calculate totals
        function calculateTotals() {
            const currencySymbol = (window.elementSdk?.config?.currency_symbol) || defaultConfig.currency_symbol;
            
            total = items.reduce((sum, item) => sum + item.price, 0);
            
            totalEl.textContent = `${currencySymbol}${total.toFixed(2)}`;
            
            calculateChange();
        }

        // Calculate change
        function calculateChange() {
            const amountPaid = parseFloat(amountPaidInput.value) || 0;
            const currencySymbol = (window.elementSdk?.config?.currency_symbol) || defaultConfig.currency_symbol;
            
            if (amountPaid === 0) {
                changeSectionEl.classList.add('hidden');
                insufficientSectionEl.classList.add('hidden');
                return;
            }
            
            if (amountPaid >= total) {
                const change = amountPaid - total;
                changeAmountEl.textContent = `${currencySymbol}${change.toFixed(2)}`;
                changeSectionEl.classList.remove('hidden');
                insufficientSectionEl.classList.add('hidden');
            } else {
                const owed = total - amountPaid;
                owedAmountEl.textContent = `${currencySymbol}${owed.toFixed(2)}`;
                insufficientSectionEl.classList.remove('hidden');
                changeSectionEl.classList.add('hidden');
            }
        }

        // Clear all data
        function clearAll() {
            items = [];
            itemPriceInput.value = '';
            amountPaidInput.value = '';
            renderItems();
            calculateTotals();
        }

        // Event listeners
        addItemBtn.addEventListener('click', addItem);
        
        itemPriceInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addItem();
            }
        });
        

        
        amountPaidInput.addEventListener('input', calculateChange);
        clearAllBtn.addEventListener('click', clearAll);

        // Element SDK integration
        async function onConfigChange(config) {
            const storeTitle = document.getElementById('store-title');
            
            storeTitle.textContent = config.store_name || defaultConfig.store_name;
            
            // Recalculate to update currency symbols
            calculateTotals();
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.background_color || "#f0f4f8",
                        set: (value) => {
                            config.background_color = value;
                            window.elementSdk.setConfig({ background_color: value });
                        }
                    },
                    {
                        get: () => config.card_color || "#ffffff",
                        set: (value) => {
                            config.card_color = value;
                            window.elementSdk.setConfig({ card_color: value });
                        }
                    },
                    {
                        get: () => config.primary_color || "#3b82f6",
                        set: (value) => {
                            config.primary_color = value;
                            window.elementSdk.setConfig({ primary_color: value });
                        }
                    },
                    {
                        get: () => config.text_color || "#374151",
                        set: (value) => {
                            config.text_color = value;
                            window.elementSdk.setConfig({ text_color: value });
                        }
                    },
                    {
                        get: () => config.accent_color || "#10b981",
                        set: (value) => {
                            config.accent_color = value;
                            window.elementSdk.setConfig({ accent_color: value });
                        }
                    }
                ],
                borderables: [],
                fontEditable: {
                    get: () => config.font_family || "Inter",
                    set: (value) => {
                        config.font_family = value;
                        window.elementSdk.setConfig({ font_family: value });
                    }
                },
                fontSizeable: {
                    get: () => config.font_size || 16,
                    set: (value) => {
                        config.font_size = value;
                        window.elementSdk.setConfig({ font_size: value });
                    }
                }
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["store_name", config.store_name || defaultConfig.store_name],
                ["currency_symbol", config.currency_symbol || defaultConfig.currency_symbol]
            ]);
        }

        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }

        // Initialize the calculator
        renderItems();
        calculateTotals();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9972052843e4bc55',t:'MTc2MTkwMTgzNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
