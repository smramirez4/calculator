<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Store POS &amp; Inventory Management</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        .receipt-paper {
            background: linear-gradient(to bottom, #ffffff 0%, #f8f9fa 100%);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        @media print {
            .no-print { display: none !important; }
            .receipt-paper { box-shadow: none; }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full bg-gray-50 font-sans">
  <header class="bg-blue-600 text-white p-4 shadow-lg">
   <div class="flex justify-between items-center">
    <h1 id="store-title" class="text-2xl font-bold">Mi Tienda POS</h1>
    <div class="flex space-x-4"><button id="pos-tab" class="px-4 py-2 bg-blue-700 rounded-lg font-medium">POS</button> <button id="inventory-tab" class="px-4 py-2 bg-blue-500 rounded-lg font-medium hover:bg-blue-700 transition-colors">Inventory</button> <button id="reports-tab" class="px-4 py-2 bg-blue-500 rounded-lg font-medium hover:bg-blue-700 transition-colors">Reports</button>
    </div>
   </div>
  </header>
  <main class="p-6"><!-- POS Section -->
   <section id="pos-section" class="max-w-4xl mx-auto"><!-- Product Search & Cart -->
    <div class="space-y-6"><!-- Search Bar -->
     <div class="bg-white p-6 rounded-lg shadow-md"><label for="product-search" class="block text-sm font-medium text-gray-700 mb-2">Search Products</label>
      <div class="flex space-x-2"><input type="text" id="product-search" placeholder="Search by product name..." class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"> <button id="add-to-cart-btn" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium"> Add to Cart </button>
      </div>
     </div><!-- Shopping Cart -->
     <div class="bg-white p-6 rounded-lg shadow-md">
      <h3 class="text-lg font-semibold mb-4">Shopping Cart</h3>
      <div id="cart-items" class="space-y-2 mb-4">
       <p class="text-gray-500 text-center py-8">Cart is empty</p>
      </div>
      <div class="border-t pt-4">
       <div class="flex justify-between items-center text-xl font-bold"><span>Total:</span> <span id="cart-total">₱0.00</span>
       </div>
       <div class="flex space-x-2 mt-4"><button id="clear-cart-btn" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"> Clear Cart </button> <button id="checkout-btn" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"> Process Payment </button>
       </div>
      </div>
     </div>
    </div>
   </section><!-- Inventory Section -->
   <section id="inventory-section" class="hidden space-y-6"><!-- Add Product Form -->
    <div class="bg-white p-6 rounded-lg shadow-md">
     <h3 class="text-lg font-semibold mb-4">Add New Product</h3>
     <form id="add-product-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      <div><label for="product-name" class="block text-sm font-medium text-gray-700 mb-1">Product Name</label> <input type="text" id="product-name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>
      <div><label for="product-price" class="block text-sm font-medium text-gray-700 mb-1">Price (₱)</label> <input type="number" id="product-price" step="0.01" min="0" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>
      <div><label for="product-stock" class="block text-sm font-medium text-gray-700 mb-1">Stock Quantity</label> <input type="number" id="product-stock" min="0" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>
      <div><label for="product-category" class="block text-sm font-medium text-gray-700 mb-1">Category</label> <input type="text" id="product-category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>
      <div class="flex items-end"><button type="submit" id="add-product-btn" class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium"> Add Product </button>
      </div>
     </form>
    </div><!-- Products List -->
    <div class="bg-white p-6 rounded-lg shadow-md">
     <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold">Product Inventory</h3>
      <div class="text-sm text-gray-600">
       Total Products: <span id="total-products">0</span>
      </div>
     </div>
     <div class="overflow-x-auto">
      <table class="w-full table-auto">
       <thead>
        <tr class="bg-gray-50">
         <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Name</th>
         <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Price</th>
         <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Stock</th>
         <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Category</th>
         <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Actions</th>
        </tr>
       </thead>
       <tbody id="products-table">
        <tr>
         <td colspan="5" class="px-4 py-8 text-center text-gray-500">No products added yet</td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </section><!-- Reports Section -->
   <section id="reports-section" class="hidden space-y-6">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6"><!-- Summary Cards -->
     <div class="bg-white p-6 rounded-lg shadow-md">
      <h4 class="text-sm font-medium text-gray-600 mb-2">Total Products</h4>
      <p id="report-total-products" class="text-3xl font-bold text-blue-600">0</p>
     </div>
     <div class="bg-white p-6 rounded-lg shadow-md">
      <h4 class="text-sm font-medium text-gray-600 mb-2">Total Inventory Value</h4>
      <p id="report-inventory-value" class="text-3xl font-bold text-green-600">₱0.00</p>
     </div>
     <div class="bg-white p-6 rounded-lg shadow-md">
      <h4 class="text-sm font-medium text-gray-600 mb-2">Low Stock Items</h4>
      <p id="report-low-stock" class="text-3xl font-bold text-red-600">0</p>
     </div>
    </div><!-- Low Stock Alert -->
    <div class="bg-white p-6 rounded-lg shadow-md">
     <h3 class="text-lg font-semibold mb-4">Low Stock Alert (≤5 items)</h3>
     <div id="low-stock-list" class="space-y-2">
      <p class="text-gray-500">No low stock items</p>
     </div>
    </div>
   </section>
  </main><!-- Payment Modal -->
  <div id="payment-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
   <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full mx-4">
    <h3 class="text-xl font-bold mb-6 text-center">Process Payment</h3>
    <div class="space-y-4">
     <div class="text-center">
      <p class="text-sm text-gray-600 mb-2">Total Amount</p>
      <p id="payment-total" class="text-3xl font-bold text-blue-600">₱0.00</p>
     </div>
     <div><label for="cash-received" class="block text-sm font-medium text-gray-700 mb-2">Cash Received (₱)</label> <input type="number" id="cash-received" step="0.01" min="0" class="w-full px-4 py-3 text-xl border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-center" placeholder="0.00">
     </div>
     <div id="change-display" class="hidden">
      <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
       <p class="text-sm text-gray-600 mb-1">Change</p>
       <p id="change-amount" class="text-2xl font-bold text-green-600">₱0.00</p>
      </div>
     </div>
     <div id="insufficient-display" class="hidden">
      <div class="bg-red-50 border border-red-200 rounded-lg p-4 text-center">
       <p class="text-sm text-red-600 mb-1">Insufficient Amount</p>
       <p id="shortage-amount" class="text-lg font-medium text-red-600">Need ₱0.00 more</p>
      </div>
     </div><!-- Quick Cash Buttons -->
     <div class="grid grid-cols-3 gap-2 mt-4"><button class="quick-cash-btn px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors" data-amount="20">₱20</button> <button class="quick-cash-btn px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors" data-amount="50">₱50</button> <button class="quick-cash-btn px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors" data-amount="100">₱100</button> <button class="quick-cash-btn px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors" data-amount="200">₱200</button> <button class="quick-cash-btn px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors" data-amount="500">₱500</button> <button class="quick-cash-btn px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors" data-amount="1000">₱1000</button>
     </div>
     <div class="flex space-x-3 mt-6"><button id="cancel-payment-btn" class="flex-1 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors"> Cancel </button> <button id="complete-payment-btn" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors" disabled> Complete Sale </button>
     </div>
    </div>
   </div>
  </div>
  <script>
        // Global variables
        let products = [];
        let cart = [];

        let isLoading = false;

        // Configuration
        const defaultConfig = {
            store_name: "Mi Tienda POS",
            receipt_footer: "Thank you for shopping with us!"
        };

        // Data handler for SDK
        const dataHandler = {
            onDataChanged(data) {
                products = data || [];
                updateProductsTable();
                updateReports();
                updateProductSearch();
            }
        };

        // Element SDK configuration
        const elementConfig = {
            defaultConfig,
            onConfigChange: async (config) => {
                const storeName = config.store_name || defaultConfig.store_name;
                const receiptFooter = config.receipt_footer || defaultConfig.receipt_footer;
                
                document.getElementById('store-title').textContent = storeName;
                document.getElementById('receipt-store-name').textContent = storeName;
                document.getElementById('receipt-footer-text').textContent = receiptFooter;
            },
            mapToCapabilities: (config) => ({
                recolorables: [
                    {
                        get: () => config.primary_color || "#2563eb",
                        set: (value) => {
                            config.primary_color = value;
                            window.elementSdk.setConfig({ primary_color: value });
                        }
                    }
                ],
                borderables: [],
                fontEditable: {
                    get: () => config.font_family || "Inter, sans-serif",
                    set: (value) => {
                        config.font_family = value;
                        window.elementSdk.setConfig({ font_family: value });
                    }
                },
                fontSizeable: {
                    get: () => config.font_size || 16,
                    set: (value) => {
                        config.font_size = value;
                        window.elementSdk.setConfig({ font_size: value });
                    }
                }
            }),
            mapToEditPanelValues: (config) => new Map([
                ["store_name", config.store_name || defaultConfig.store_name],
                ["receipt_footer", config.receipt_footer || defaultConfig.receipt_footer]
            ])
        };

        // Initialize application
        async function initApp() {
            try {
                // Initialize Element SDK
                if (window.elementSdk) {
                    await window.elementSdk.init(elementConfig);
                }

                // Initialize Data SDK
                const initResult = await window.dataSdk.init(dataHandler);
                if (!initResult.isOk) {
                    console.error("Failed to initialize data SDK");
                    return;
                }

                setupEventListeners();
                updateReceiptDate();
            } catch (error) {
                console.error("Failed to initialize app:", error);
            }
        }

        // Event listeners
        function setupEventListeners() {
            // Tab navigation
            document.getElementById('pos-tab').addEventListener('click', () => switchTab('pos'));
            document.getElementById('inventory-tab').addEventListener('click', () => switchTab('inventory'));
            document.getElementById('reports-tab').addEventListener('click', () => switchTab('reports'));

            // POS functionality
            document.getElementById('add-to-cart-btn').addEventListener('click', addToCart);
            document.getElementById('clear-cart-btn').addEventListener('click', clearCart);
            document.getElementById('checkout-btn').addEventListener('click', openPaymentModal);


            // Payment modal functionality
            document.getElementById('cancel-payment-btn').addEventListener('click', closePaymentModal);
            document.getElementById('complete-payment-btn').addEventListener('click', completePayment);
            document.getElementById('cash-received').addEventListener('input', calculateChange);
            
            // Quick cash buttons
            document.querySelectorAll('.quick-cash-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const amount = parseFloat(e.target.dataset.amount);
                    document.getElementById('cash-received').value = amount.toFixed(2);
                    calculateChange();
                });
            });

            // Inventory functionality
            document.getElementById('add-product-form').addEventListener('submit', addProduct);

            // Search functionality
            document.getElementById('product-search').addEventListener('input', updateProductSearch);
        }

        // Tab switching
        function switchTab(tab) {
            // Hide all sections
            document.getElementById('pos-section').classList.add('hidden');
            document.getElementById('inventory-section').classList.add('hidden');
            document.getElementById('reports-section').classList.add('hidden');

            // Reset tab styles
            document.querySelectorAll('header button').forEach(btn => {
                btn.className = 'px-4 py-2 bg-blue-500 rounded-lg font-medium hover:bg-blue-700 transition-colors';
            });

            // Show selected section and highlight tab
            if (tab === 'pos') {
                document.getElementById('pos-section').classList.remove('hidden');
                document.getElementById('pos-tab').className = 'px-4 py-2 bg-blue-700 rounded-lg font-medium';
            } else if (tab === 'inventory') {
                document.getElementById('inventory-section').classList.remove('hidden');
                document.getElementById('inventory-tab').className = 'px-4 py-2 bg-blue-700 rounded-lg font-medium';
            } else if (tab === 'reports') {
                document.getElementById('reports-section').classList.remove('hidden');
                document.getElementById('reports-tab').className = 'px-4 py-2 bg-blue-700 rounded-lg font-medium';
                updateReports();
            }
        }

        // Product management
        async function addProduct(event) {
            event.preventDefault();
            
            if (products.length >= 999) {
                showMessage("Maximum limit of 999 products reached. Please delete some products first.", "error");
                return;
            }

            if (isLoading) return;
            setLoading(true);

            const formData = new FormData(event.target);
            const product = {
                id: Date.now().toString(),
                name: document.getElementById('product-name').value,
                price: parseFloat(document.getElementById('product-price').value),
                stock: parseInt(document.getElementById('product-stock').value),
                category: document.getElementById('product-category').value || 'General',
                createdAt: new Date().toISOString()
            };

            const result = await window.dataSdk.create(product);
            
            if (result.isOk) {
                event.target.reset();
                showMessage("Product added successfully!", "success");
            } else {
                showMessage("Failed to add product. Please try again.", "error");
            }
            
            setLoading(false);
        }

        async function deleteProduct(productId) {
            if (isLoading) return;
            
            const product = products.find(p => p.id === productId);
            if (!product) return;

            setLoading(true);
            const result = await window.dataSdk.delete(product);
            
            if (result.isOk) {
                showMessage("Product deleted successfully!", "success");
            } else {
                showMessage("Failed to delete product. Please try again.", "error");
            }
            
            setLoading(false);
        }

        function editProduct(productId) {
            // Hide display elements and show edit elements
            document.getElementById(`price-display-${productId}`).classList.add('hidden');
            document.getElementById(`stock-display-${productId}`).classList.add('hidden');
            document.getElementById(`actions-view-${productId}`).classList.add('hidden');
            
            document.getElementById(`price-edit-${productId}`).classList.remove('hidden');
            document.getElementById(`stock-edit-${productId}`).classList.remove('hidden');
            document.getElementById(`actions-edit-${productId}`).classList.remove('hidden');
        }

        function cancelEdit(productId) {
            // Show display elements and hide edit elements
            document.getElementById(`price-display-${productId}`).classList.remove('hidden');
            document.getElementById(`stock-display-${productId}`).classList.remove('hidden');
            document.getElementById(`actions-view-${productId}`).classList.remove('hidden');
            
            document.getElementById(`price-edit-${productId}`).classList.add('hidden');
            document.getElementById(`stock-edit-${productId}`).classList.add('hidden');
            document.getElementById(`actions-edit-${productId}`).classList.add('hidden');

            // Reset input values to original
            const product = products.find(p => p.id === productId);
            if (product) {
                document.querySelector(`#price-edit-${productId} input`).value = product.price;
                document.querySelector(`#stock-edit-${productId} input`).value = product.stock;
            }
        }

        async function saveProduct(productId) {
            if (isLoading) return;
            
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const newPrice = parseFloat(document.querySelector(`#price-edit-${productId} input`).value);
            const newStock = parseInt(document.querySelector(`#stock-edit-${productId} input`).value);

            if (isNaN(newPrice) || newPrice < 0) {
                showMessage("Please enter a valid price!", "error");
                return;
            }

            if (isNaN(newStock) || newStock < 0) {
                showMessage("Please enter a valid stock quantity!", "error");
                return;
            }

            setLoading(true);

            const updatedProduct = {
                ...product,
                price: newPrice,
                stock: newStock
            };

            const result = await window.dataSdk.update(updatedProduct);
            
            if (result.isOk) {
                showMessage("Product updated successfully!", "success");
                cancelEdit(productId);
            } else {
                showMessage("Failed to update product. Please try again.", "error");
            }
            
            setLoading(false);
        }

        // POS functionality
        function addToCart() {
            const searchTerm = document.getElementById('product-search').value.trim().toLowerCase();
            if (!searchTerm) return;

            const product = products.find(p => 
                p.name.toLowerCase().includes(searchTerm)
            );

            if (!product) {
                showMessage("Product not found!", "error");
                return;
            }

            if (product.stock <= 0) {
                showMessage("Product out of stock!", "error");
                return;
            }

            const existingItem = cart.find(item => item.id === product.id);
            if (existingItem) {
                if (existingItem.quantity >= product.stock) {
                    showMessage("Not enough stock available!", "error");
                    return;
                }
                existingItem.quantity++;
            } else {
                cart.push({
                    ...product,
                    quantity: 1
                });
            }

            document.getElementById('product-search').value = '';
            updateCart();
            showMessage("Product added to cart!", "success");
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCart();
        }

        function updateCartQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (!item) return;

            const product = products.find(p => p.id === productId);
            const newQuantity = item.quantity + change;

            if (newQuantity <= 0) {
                removeFromCart(productId);
            } else if (newQuantity <= product.stock) {
                item.quantity = newQuantity;
                updateCart();
            } else {
                showMessage("Not enough stock available!", "error");
            }
        }

        function clearCart() {
            cart = [];
            updateCart();
        }

        // Payment modal functions
        function openPaymentModal() {
            if (cart.length === 0) {
                showMessage("Cart is empty!", "error");
                return;
            }

            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('payment-total').textContent = `₱${total.toFixed(2)}`;
            document.getElementById('cash-received').value = '';
            document.getElementById('change-display').classList.add('hidden');
            document.getElementById('insufficient-display').classList.add('hidden');
            document.getElementById('complete-payment-btn').disabled = true;
            document.getElementById('payment-modal').classList.remove('hidden');
            
            // Focus on cash input
            setTimeout(() => {
                document.getElementById('cash-received').focus();
            }, 100);
        }

        function closePaymentModal() {
            document.getElementById('payment-modal').classList.add('hidden');
        }

        function calculateChange() {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const cashReceived = parseFloat(document.getElementById('cash-received').value) || 0;
            const change = cashReceived - total;

            const changeDisplay = document.getElementById('change-display');
            const insufficientDisplay = document.getElementById('insufficient-display');
            const completeBtn = document.getElementById('complete-payment-btn');

            if (cashReceived === 0) {
                changeDisplay.classList.add('hidden');
                insufficientDisplay.classList.add('hidden');
                completeBtn.disabled = true;
            } else if (change >= 0) {
                // Sufficient payment
                changeDisplay.classList.remove('hidden');
                insufficientDisplay.classList.add('hidden');
                document.getElementById('change-amount').textContent = `₱${change.toFixed(2)}`;
                completeBtn.disabled = false;
            } else {
                // Insufficient payment
                changeDisplay.classList.add('hidden');
                insufficientDisplay.classList.remove('hidden');
                document.getElementById('shortage-amount').textContent = `Need ₱${Math.abs(change).toFixed(2)} more`;
                completeBtn.disabled = true;
            }
        }

        async function completePayment() {
            if (isLoading) return;
            setLoading(true);

            // Update stock for each item in cart
            for (const cartItem of cart) {
                const product = products.find(p => p.id === cartItem.id);
                if (product) {
                    const updatedProduct = {
                        ...product,
                        stock: product.stock - cartItem.quantity
                    };
                    await window.dataSdk.update(updatedProduct);
                }
            }

            const cashReceived = parseFloat(document.getElementById('cash-received').value);
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const change = cashReceived - total;

            showMessage(`Sale completed! Change: ₱${change.toFixed(2)}`, "success");
            clearCart();
            closePaymentModal();
            setLoading(false);
        }



        // UI Updates
        function updateCart() {
            const cartItems = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');

            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="text-gray-500 text-center py-8">Cart is empty</p>';
                cartTotal.textContent = '₱0.00';
                return;
            }

            let total = 0;
            let cartHTML = '';

            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;

                cartHTML += `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <div class="flex-1">
                            <h4 class="font-medium">${item.name}</h4>
                            <p class="text-sm text-gray-600">₱${item.price.toFixed(2)} each</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="updateCartQuantity('${item.id}', -1)" 
                                    class="w-8 h-8 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors">-</button>
                            <span class="w-8 text-center font-medium">${item.quantity}</span>
                            <button onclick="updateCartQuantity('${item.id}', 1)" 
                                    class="w-8 h-8 bg-green-500 text-white rounded-full hover:bg-green-600 transition-colors">+</button>
                            <button onclick="removeFromCart('${item.id}')" 
                                    class="ml-2 px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition-colors text-sm">Remove</button>
                        </div>
                        <div class="ml-4 font-medium">₱${itemTotal.toFixed(2)}</div>
                    </div>
                `;
            });

            cartItems.innerHTML = cartHTML;
            cartTotal.textContent = `₱${total.toFixed(2)}`;
        }



        function updateProductsTable() {
            const tbody = document.getElementById('products-table');
            const totalProducts = document.getElementById('total-products');

            totalProducts.textContent = products.length;

            if (products.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">No products added yet</td></tr>';
                return;
            }

            const html = products.map(product => `
                <tr class="border-b hover:bg-gray-50" id="product-row-${product.id}">
                    <td class="px-4 py-3">
                        <div class="font-medium">${product.name}</div>
                    </td>
                    <td class="px-4 py-3">
                        <div id="price-display-${product.id}">₱${product.price.toFixed(2)}</div>
                        <div id="price-edit-${product.id}" class="hidden">
                            <input type="number" step="0.01" min="0" value="${product.price}" 
                                   class="w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </td>
                    <td class="px-4 py-3">
                        <div id="stock-display-${product.id}">
                            <span class="px-2 py-1 rounded-full text-sm ${product.stock <= 5 ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                ${product.stock}
                            </span>
                        </div>
                        <div id="stock-edit-${product.id}" class="hidden">
                            <input type="number" min="0" value="${product.stock}" 
                                   class="w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </td>
                    <td class="px-4 py-3">${product.category}</td>
                    <td class="px-4 py-3">
                        <div id="actions-view-${product.id}" class="flex space-x-2">
                            <button onclick="editProduct('${product.id}')" 
                                    class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors text-sm">
                                Edit
                            </button>
                            <button onclick="deleteProduct('${product.id}')" 
                                    class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition-colors text-sm">
                                Delete
                            </button>
                        </div>
                        <div id="actions-edit-${product.id}" class="hidden flex space-x-2">
                            <button onclick="saveProduct('${product.id}')" 
                                    class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 transition-colors text-sm">
                                Save
                            </button>
                            <button onclick="cancelEdit('${product.id}')" 
                                    class="px-3 py-1 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors text-sm">
                                Cancel
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');

            tbody.innerHTML = html;
        }

        function updateProductSearch() {
            // This function could be enhanced to show search suggestions
        }

        function updateReports() {
            const totalProducts = products.length;
            const inventoryValue = products.reduce((sum, product) => sum + (product.price * product.stock), 0);
            const lowStockItems = products.filter(product => product.stock <= 5);

            document.getElementById('report-total-products').textContent = totalProducts;
            document.getElementById('report-inventory-value').textContent = `₱${inventoryValue.toFixed(2)}`;
            document.getElementById('report-low-stock').textContent = lowStockItems.length;

            const lowStockList = document.getElementById('low-stock-list');
            if (lowStockItems.length === 0) {
                lowStockList.innerHTML = '<p class="text-gray-500">No low stock items</p>';
            } else {
                const html = lowStockItems.map(product => `
                    <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg border border-red-200">
                        <div>
                            <span class="font-medium">${product.name}</span>
                            <span class="text-sm text-gray-600 ml-2">(${product.category})</span>
                        </div>
                        <span class="px-2 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium">
                            ${product.stock} left
                        </span>
                    </div>
                `).join('');
                lowStockList.innerHTML = html;
            }
        }



        // Utility functions
        function setLoading(loading) {
            isLoading = loading;
            const buttons = document.querySelectorAll('button');
            buttons.forEach(btn => {
                if (loading) {
                    btn.classList.add('loading');
                } else {
                    btn.classList.remove('loading');
                }
            });
        }

        function showMessage(message, type) {
            // Create toast message
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white font-medium z-50 ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            }`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99721e600649bc55',t:'MTc2MTkwMjg2OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>